<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Contact Picker — Demo</title>

  <style>
    body {
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      padding: 24px;
      max-width: 780px;
      margin: auto;
      background: #f2f4f7;
    }

    h1 {
      text-align: center;
      font-weight: 700;
      color: #111827;
    }

    .card {
      background: #ffffff;
      padding: 28px;
      border-radius: 18px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
      border: 1px solid #e5e7eb;
      margin-top: 24px;
    }

    button {
      padding: 12px 18px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: 0.15s;
      border: none;
    }

    #pickBtn {
      background: #2563eb;
      color: white;
    }
    #pickBtn:hover {
      background: #1e4fc7;
    }

    #openFallbackBtn {
      background: #e5e7eb;
      color: #111;
    }
    #openFallbackBtn:hover {
      background: #d1d5db;
    }

    #fallbackForm {
      margin-top: 20px;
      display: none;
      background: #f9fafb;
      padding: 18px;
      border-radius: 14px;
      border: 1px solid #e5e7eb;
    }

    .field {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
      align-items: center;
    }

    label {
      width: 90px;
      font-weight: 600;
      color: #374151;
    }

    input {
      flex: 1;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      background: white;
      font-size: 15px;
    }

    input:focus {
      border-color: #2563eb;
      outline: none;
      box-shadow: 0 0 0 3px rgba(37,99,235,0.2);
    }

    pre {
      background: #111827;
      color: #e5e7eb;
      padding: 16px;
      border-radius: 10px;
      overflow: auto;
      font-size: 14px;
      margin-top: 14px;
    }

    #saveFallback {
      background: #10b981;
      color: white;
    }
    #saveFallback:hover {
      background: #0d9669;
    }

    #cancelFallback {
      background: #e5e7eb;
      color: #111;
    }
    #cancelFallback:hover {
      background: #d1d5db;
    }

    .hint {
      color: #4b5563;
      font-size: 0.95rem;
      margin-top: 10px;
      font-style: italic;
    }
  </style>
</head>

<body>
  <h1>Selector de contactos</h1>

  <div class="card">
    <p>Pulsa el botón para seleccionar un contacto desde tu dispositivo. Si tu navegador no lo soporta, podrás llenar un formulario manual.</p>

    <div style="display:flex; gap:12px; align-items:center; margin-top:16px;">
      <button id="pickBtn">Seleccionar contacto</button>
      <button id="openFallbackBtn">Usar formulario</button>
    </div>

    <div id="result" class="hint" aria-live="polite" style="margin-top:16px;"></div>

    <!-- FORMULARIO -->
    <form id="fallbackForm" novalidate>
      <div class="field">
        <label for="name">Nombre</label>
        <input id="name" name="name" type="text" placeholder="Nombre completo" />
      </div>
      <div class="field">
        <label for="tel">Teléfono</label>
        <input id="tel" name="tel" type="tel" placeholder="+52 1 55..." />
      </div>
      <div class="field">
        <label for="email">Email</label>
        <input id="email" name="email" type="email" placeholder="ejemplo@mail.com" />
      </div>

      <div style="display:flex; gap:12px; margin-top:10px;">
        <button id="saveFallback" type="button">Guardar</button>
        <button id="cancelFallback" type="button">Cancelar</button>
      </div>
    </form>

    <h3 style="margin-top:22px; color:#111827;">Respuesta cruda</h3>
    <pre id="raw">—</pre>
  </div>

  <script>
    (function () {
      const pickBtn = document.getElementById('pickBtn');
      const openFallbackBtn = document.getElementById('openFallbackBtn');
      const fallbackForm = document.getElementById('fallbackForm');
      const saveFallback = document.getElementById('saveFallback');
      const cancelFallback = document.getElementById('cancelFallback');
      const result = document.getElementById('result');
      const raw = document.getElementById('raw');

      const props = ['name', 'email', 'tel'];
      const opts = { multiple: false };

      const supportsContactPicker = ('contacts' in navigator) && (typeof navigator.contacts.select === 'function');

      if (!supportsContactPicker) {
        result.textContent = 'Tu navegador no soporta Contact Picker. Puedes usar el formulario.';
      } else {
        result.textContent = 'Contact Picker disponible.';
      }

      pickBtn.addEventListener('click', async () => {
        if (!supportsContactPicker) {
          showFallback();
          return;
        }

        try {
          const contacts = await navigator.contacts.select(props, opts);

          if (!contacts || contacts.length === 0) {
            result.textContent = 'No seleccionaste ningún contacto.';
            raw.textContent = '[]';
            return;
          }

          const c = contacts[0];
          const name = Array.isArray(c.name) ? c.name[0] : c.name || '';
          const email = Array.isArray(c.email) ? c.email[0] : c.email || '';
          const tel = Array.isArray(c.tel) ? c.tel[0] : c.tel || '';

          result.innerHTML = `<strong>Seleccionado:</strong> ${escapeHtml(name)} · ${escapeHtml(tel)} · ${escapeHtml(email)}`;
          raw.textContent = JSON.stringify(contacts, null, 2);

          document.getElementById('name').value = name;
          document.getElementById('tel').value = tel;
          document.getElementById('email').value = email;

        } catch (err) {
          result.textContent = 'Error o cancelación.';
          raw.textContent = String(err.message || err);
        }
      });

      openFallbackBtn.addEventListener('click', showFallback);
      cancelFallback.addEventListener('click', () => fallbackForm.style.display = 'none');

      saveFallback.addEventListener('click', () => {
        const name = document.getElementById('name').value.trim();
        const tel = document.getElementById('tel').value.trim();
        const email = document.getElementById('email').value.trim();

        if (!name && !tel && !email) {
          alert('Ingresa al menos un dato.');
          return;
        }

        const saved = { name, tel, email, from: 'fallback' };
        result.innerHTML = `<strong>Guardado manualmente:</strong> ${escapeHtml(name)} · ${escapeHtml(tel)} · ${escapeHtml(email)}`;
        raw.textContent = JSON.stringify(saved, null, 2);

        fallbackForm.style.display = 'none';
      });

      function showFallback() {
        fallbackForm.style.display = 'block';
        result.textContent = 'Introduce los datos manualmente.';
      }

      function escapeHtml(s) {
        return String(s).replace(/[&<>"']/g, (c) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c]);
      }
    })();
  </script>
</body>
</html>

